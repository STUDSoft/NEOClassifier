package main;

import main.Patient;

import components.Date;

import java.awt.BorderLayout;
import java.awt.Component;
import java.awt.Dimension;
import java.awt.ScrollPane;
import java.awt.event.ActionEvent;

import javax.swing.BorderFactory;
import javax.swing.BoxLayout;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JSeparator;
import javax.swing.JTextArea;
import javax.swing.JTextField;

/**
 * Class for the tabs of the patients
 * @author Daniele
 *
 */
public class PatientPanel extends JPanel {

	/** The current ID for the patient */
	private int currentID;
	/** Patient of the panel */
	private Patient patient;
	
	/** Area for the patient data */
	private JPanel pData;
	/** Area for the patient name */
	private JLabel pName;
	/** Area for the patient surname */
	private JLabel pSurname;
	/** Area for the patient date of birth */
	private JLabel pDOB;
	
	/** Area for the image gallery */
	private JPanel gallery;
	/** Scroll pane for the image gallery */
	private JScrollPane imgSP;
	/** Images size */
	private Dimension imgDim= new Dimension(200,200);
	/** Separators size */
	private Dimension sepDim= new Dimension(10,300);

	/** Area for the buttons */
	private JPanel btnPanel;
	/** Button to save patient data */
	private JButton saveBtn;
	/** Button to close patient tab */
	private JButton closeBtn;
	
	/**
	 * Default constructor
	 * @param number The number of the current patient
	 */
	public PatientPanel(int number) {
		currentID=number;
		patient=new Patient(number, "tizio", "caio", new Date(01,01,1996));
		createPanel();
	}
	
	/**
	 * Constructor for loading
	 * @param number The number of the current patient
	 * @param path The path to the folder of the patient
	 */
	public PatientPanel(int number, String path) {
		currentID=number;
		patient=new Patient(path);
		createPanel();
	}
	
	/**
	 * Creates the structure of the tab
	 */
	private void createPanel() {
		
		this.setLayout(new BoxLayout(this, BoxLayout.Y_AXIS));
		
		pData=new JPanel();
		pData.setLayout(new BoxLayout(pData, BoxLayout.X_AXIS));
		pName=new JLabel ("Nome: "+patient.getName());
		pSurname=new JLabel ("Cognome: "+patient.getSurname());
		pDOB=new JLabel ("Data di Nascita: "+patient.getDOB());
		pData.add( new JLabel("ID "+currentID+"\n"));
		pData.add(pName);
		pData.add(pSurname);
		pData.add(pDOB);
		this.add(pData);
		
		gallery=new JPanel();
		gallery.setBorder(BorderFactory.createTitledBorder("Foto"));
		gallery.setLayout(new BoxLayout(gallery,BoxLayout.X_AXIS));
		imgSP= new JScrollPane(gallery);
		Image[] tmp=patient.getImages();
		if(tmp.length==0)
			gallery.add(new JTextArea("no images"));
		else {
			for(int i=0; i<tmp.length; i++) {
				gallery.add(createImgPanel(tmp[i]));
				JSeparator jSep=new JSeparator(JSeparator.VERTICAL);
				jSep.setMaximumSize(sepDim);
				//jSep.setPreferredSize(sepDim);
				gallery.add(jSep);
			}
		}
		this.add(imgSP);
		
		btnPanel=new JPanel();
		btnPanel.setLayout(new BoxLayout(btnPanel, BoxLayout.X_AXIS));
		
		saveBtn=new JButton("save");
		saveBtn.addActionListener(new java.awt.event.ActionListener(){
			public void actionPerformed(ActionEvent e){
				patient.save();
			}
		});
		btnPanel.add(saveBtn);
		
		closeBtn=new JButton("close");
		btnPanel.add(closeBtn);
		
		this.add(btnPanel);
		
	}
	
	/**
	 * Creates the structure for one image
	 * @param img The image to show
	 */
	private JPanel createImgPanel(Image image) {
		JPanel imgPanel=new JPanel();
		imgPanel.setLayout(new BoxLayout(imgPanel,BoxLayout.Y_AXIS));
		
		JLabel when= new JLabel("Date: "+image.getDate());
		JLabel danger= new JLabel("Dangerous: "+image.isDangerous());
		
		JLabel img=new JLabel();
		img.setIcon(new ImageIcon(image.getImg().getAbsolutePath()));
		//TODO resize
		img.setMinimumSize(imgDim);
		img.setPreferredSize(imgDim);
		img.setMaximumSize(imgDim);
		
		imgPanel.add(when);
		imgPanel.add(danger);
		imgPanel.add(img);

		
		return imgPanel;
	}
	
}







